/*! webrtc_broadcast_app 10-01-2016 */!function($){"use strict";var app=angular.module("myWebRTC",[],function($locationProvider){$locationProvider.html5Mode(!0)}),client=new PeerManager;app.value("DICT",{EMAIL_TECHNICAL_SUPPORT:"alan.tai@fund364.com"}),app.controller("IndexController",["$window","$location",function($window,$location){}]),app.controller("RemoteStreamsController",["$location","$http","$window","$scope",function($location,$http,$window,$scope){function getStreamById(id){for(var i=0;i<ctrl.remoteStreams.length;i++)if(ctrl.remoteStreams[i].id===id)return ctrl.remoteStreams[i]}var ctrl=this;ctrl.remoteStreams=[],ctrl.remote_streams_db=client.get_remote_streams_db(),ctrl.name="Station",ctrl.loadData=function(){$http.get("/streams").success(function(data){for(var streams=data.filter(function(stream){return stream.id!==client.getId()}),i=0;i<streams.length;i++){var stream=getStreamById(streams[i].id);streams[i].isPlaying=stream?stream.isPlaying:!1}ctrl.remoteStreams=streams})},client.add_external_mechanism("load_data",ctrl.loadData),ctrl.view=function(stream){var remote_peer=client.peerInit(stream.id);remote_peer.start_recording_btn.addEventListener("click",function(){ctrl.start_timestamp=(new Date).getTime(),ctrl.record_rtc=RecordRTC(ctrl.remote_streams_db[remote_peer.remoteVideoEl.id],{bufferSize:16384,type:"video",frameInterval:20}),ctrl.record_rtc.startRecording(),remote_peer.stop_recording_btn.disabled=!1,remote_peer.start_recording_btn.disabled=!0}),remote_peer.stop_recording_btn.addEventListener("click",function(){remote_peer.start_recording_btn.disabled=!1,remote_peer.stop_recording_btn.disabled=!0,ctrl.stop_timestamp=(new Date).getTime();var file_name=ctrl.name+"-"+ctrl.start_timestamp+"_"+ctrl.stop_timestamp;ctrl.record_rtc.stopRecording(),ctrl.record_rtc.save(file_name)}),stream.isPlaying=!stream.isPlaying},ctrl.loadData()}])}(jQuery);