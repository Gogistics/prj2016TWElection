/*! docker-debian-hello-world 22-11-2015 */"use strict";!function(a){window.facebook_analysis_handler=window.facebook_analysis_handler||{get_analysis_collection:function(){a.ajax({data:{token:"OCweKSaVwPOgerGEhRAEBvsRNdqWEdjA"},type:"POST",url:"/services/get_facebook_latest_posts_analysis_collection",success:function(a){"successful"===a.request_status?(console.log(a.collecion),window.facebook_analysis_handler.append_latest_post(a.collecion)):console.log("fail and no data come in...")}})},append_latest_post:function(b){var c={tsaiingwen:"latest_post_tsaiingwen",llchu:"latest_post_llchu",love4tw:"latest_post_love4tw",MaYingjeou:"latest_post_MaYingjeou"},d=void 0,e=0;for(var f in b){window.facebook_analysis_handler.build_shares_chart(c[f],b[f].data);var g="...";b[f].data[0].message&&(g=b[f].data[0].message),g=g.replace(/(http[s]*:[^\s]+)/gi,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"}),d=void 0,e=0,b[f].data[0].hasOwnProperty("shares")&&(d=b[f].data[0].shares,e=d.count);var h=a("#"+c[f]);h.append('<div class="post_message"><strong style="font-size: 10px; font-weight: bold;">Latest Post</strong><br/><strong style="font-size: 10px;">Shares:&nbsp;'+e+'</strong><br/><strong style="font-size: 10px;">'+new Date(b[f].data[0].created_time)+'</strong><img src="'+b[f].data[0].picture+'" class="img-responsive"/><p style="font-size: 12px; margin-top: 10px;">'+g+'</p></div><a href="'+b[f].data[0].link+'" target="_blank">Post Link</a>')}},build_shares_chart:function(b,c){function d(){return d3.svg.axis().scale(m).orient("left").ticks(5)}var e=[],f={count:0,date:"",message:"",link:""};for(var g in c)if(!(new Date(c[g].created_time).getTime()<new Date("10-31-2015").getTime())){var h=c[g].hasOwnProperty("shares")?c[g].shares.count:0;e.push({date:new Date(c[g].created_time),value:h}),h>=f.count&&(f.count=h,f.date=c[g].created_time,f.message=c[g].message,f.link=c[g].link)}e.reverse();var i={top:30,right:30,bottom:30,left:30},j=200-i.left-i.right,k=100-i.top-i.bottom,l=d3.time.scale().range([0,j]),m=d3.scale.linear().range([k,0]),n=d3.svg.axis().scale(l).orient("bottom").ticks(2),o=d3.svg.axis().scale(m).orient("left").ticks(3,"s"),p=d3.svg.line().x(function(a){return l(a.date)}).y(function(a){return m(a.value)}),q=d3.select("div#"+b).append("svg").attr("width",j+i.left+i.right).attr("height",k+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")");q.append("text").attr("class","d3_title").attr("x",j/2).attr("y",0-i.top/2-5).attr("text-anchor","middle").text("Shares of Latest 25 Posts"),q.append("svg:g").attr("class","grid").call(d().tickSize(-j,0,0).tickFormat("")),l.domain(d3.extent(e,function(a){return a.date})),m.domain([0,d3.max(e,function(a){return Math.max(a.value)})]),q.append("path").attr("class","line_1").attr("d",p(e)),q.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").style("font-size",9).call(n),q.append("g").attr("class","y axis").style("fill","#c79825").call(o);var r=d3.bisector(function(a){return a.date}).left,s=d3.format("s"),t=function(a){return s(a)},u=d3.select("div#summary_tip").append("div").attr("class","tooltip").style("opacity",0),v=q.append("g").attr("class","focus").style("display","none");v.append("circle").attr("r",3),v.append("text").attr("x",9).attr("dy",".3em"),q.append("rect").attr("class","overlay").attr("width",j).attr("height",k).on("mouseout",function(){u.transition().duration(300).style("opacity",0)}).on("mousemove",function(){var a=l.invert(d3.mouse(this)[0]),b=r(e,a,1),c=e[b-1],d=e[b];if(c&&d){var f=a-c.date>d.date-a?d:c;u.transition().duration(200).style("opacity",.9),u.html("<div><strong>Date:&nbsp;"+f.date.toLocaleDateString()+"</strong><br/><p><label>Shares:&nbsp;</label>"+t(f.value)+"</p></div>").style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px")}});var w=f.message.replace(/(http[s]*:[^\s]+)/gi,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"}),x=a("#"+b);x.append('<div class="post_message"><strong style="font-size: 10px; font-weight: bold;">Post with Heighest Shares</strong><br/><strong style="font-size: 10px;">Shares:&nbsp;'+f.count+'</strong><br/><strong style="font-size: 10px;">'+new Date(f.date)+'</strong><p style="font-size: 12px; margin-top: 10px;">'+w+'</p></div><a href="'+f.link+'" target="_blank">Post Link</a><hr/>')}},window.facebook_analysis_handler.get_analysis_collection()}(jQuery);