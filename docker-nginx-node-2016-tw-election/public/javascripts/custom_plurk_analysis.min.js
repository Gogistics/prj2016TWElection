/*! docker-debian-hello-world 22-11-2015 */"use strict";!function(a){window.plurk_analysis_handler=window.plurk_analysis_handler||{get_analysis_collection:function(){var b=this;a.ajax({data:{token:"IcsEegBbPOgerGEhRAEBYLRsSLtAA"},type:"POST",url:"/services/get_plurk_posts_analysis_collection_by_lang_type",success:function(a){"successful"===a.request_status?(b.append_categorized_data(a.collecion,a.count_of_total_tweets),b.display_plurk_posts_chart(a.collecion)):console.log("fail...")}})},append_categorized_data:function(b,c){var d=void 0,e=void 0;for(var f in b){var g=b[f].timestamp_set,h=0;for(var i in g)d=void 0===d?i:Math.min(d,i),e=void 0===e?i:Math.max(e,i),h+=g[i];var j='<li class="list-group-item">'+f+'<span class="label label-warning label-pill pull-right">'+h+" ("+(h/c*100).toFixed(2)+"%)</span></li>";a("ul#categorized_plurk_posts_collection").append(j)}var k=new Date(d),l=new Date(e);a("p#categorized_plurk_posts_collection_period").prepend("From "+(k.getMonth()+1)+"-"+k.getDate()+"-"+k.getFullYear()+" To "+(l.getMonth()+1)+"-"+l.getDate()+"-"+l.getFullYear())},display_plurk_posts_chart:function(a){var b={};for(var c in a)for(var d in a[c].timestamp_set)b.hasOwnProperty(d)?b[d]+=a[c].timestamp_set[d]:b[d]=a[c].timestamp_set[d];var e={top:10,right:30,bottom:30,left:60},f=480-e.left-e.right,g=250-e.top-e.bottom,h=d3.time.scale().range([0,f]),i=d3.scale.linear().range([g,0]),j=d3.svg.axis().scale(h).orient("bottom").ticks(5),k=d3.svg.axis().scale(i).orient("left").ticks(5),l=d3.svg.line().x(function(a){return h(a.date)}).y(function(a){return i(a.value)}),m=d3.select("div#plurk_posts_chart").append("svg").attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),n=function(){return d3.svg.axis().scale(i).orient("left").ticks(5)};m.append("svg:g").attr("class","grid").call(n().tickSize(-f,0,0).tickFormat(""));var o=function(a){var b=[];for(var c in a)b.push({date:new Date(Number(c)),value:a[c]});b.sort(function(a,b){return a.date-b.date}),h.domain(d3.extent(b,function(a){return a.date})),i.domain([0,d3.max(b,function(a){return Math.max(a.value)})]),m.append("path").attr("class","line_1").attr("d",l(b)),m.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(j),m.append("g").attr("class","y axis").style("fill","#c79825").call(k).append("text").attr("transform","rotate(-90)").attr("y",-50).attr("dy",".4em").style("text-anchor","end").style("font-size",12).text("Posts");var d=d3.bisector(function(a){return a.date}).left,e=d3.format(",.0f"),n=function(a){return e(a)},o=d3.select("div#summary_tip").append("div").attr("class","tooltip").style("opacity",0),p=m.append("g").attr("class","focus").style("display","none");p.append("circle").attr("r",3),p.append("text").attr("x",9).attr("dy",".3em"),m.append("rect").attr("class","overlay").attr("width",f).attr("height",g).on("mouseout",function(){o.transition().duration(300).style("opacity",0)}).on("mousemove",function(){var a=h.invert(d3.mouse(this)[0]),c=d(b,a,1),e=b[c-1],f=b[c];if(e&&f){var g=a-e.date>f.date-a?f:e;o.transition().duration(200).style("opacity",.9),o.html("<div><strong>Date:&nbsp;"+g.date.toLocaleDateString()+"</strong><br/><p><label>Posts:&nbsp;</label>"+n(g.value)+"</p></div>").style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px")}})};o(b)}},window.plurk_analysis_handler.get_analysis_collection()}(jQuery);